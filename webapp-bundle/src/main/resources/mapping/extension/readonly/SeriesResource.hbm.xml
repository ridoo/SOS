<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN" "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="org.n52.series.db.beans">
    <class name="DatasetEntity" table="series">
        <id name="pkid" type="long">
            <column name="seriesid"/>
            <generator class="assigned"/>
        </id>

        <discriminator formula="'measurement'" force="true" type="string"/>

        <many-to-one class="CategoryEntity" column="observablepropertyid" name="category" insert="false" update="false" />
        <many-to-one class="ProcedureEntity" column="procedureid" name="procedure" insert="false" update="false" />
        <many-to-one class="PhenomenonEntity" column="observablepropertyid" name="phenomenon" insert="false" update="false" />
        <many-to-one class="FeatureEntity" column="featureofinterestid" name="feature" insert="false" update="false" />
        <many-to-one class="PlatformEntity" column="procedureid" name="platform"/>
        <property name="published" type="org.hibernate.type.TrueFalseType" formula="'T'" />
        <property formula="'measurement'" name="datasetType" type="string"/>
        <subclass name="MeasurementDatasetEntity" discriminator-value="measurement">
            <property name="numberOfDecimals" type="int" formula="3" />
            <many-to-one class="UnitEntity" column="seriesid" name="unit" insert="false" update="false" />
            
            <property name="firstValueAt" column="firsttimestamp" type="timestamp"/>
            <property name="lastValueAt" column="lasttimestamp" type="timestamp"/>
            
<!--             <component class="MeasurementDataEntity" name="firstValue"> -->
<!--                 <property column="firsttimestamp" name="timestamp" type="timestamp"/> -->
<!--                 <property column="firstvalue" name="value" type="double"/> -->
<!--             </component> -->
<!--             <component class="MeasurementDataEntity" name="lastValue"> -->
<!--                 <property column="lasttimestamp" name="timestamp" type="timestamp"/> -->
<!--                 <property column="lastvalue" name="value" type="double"/> -->
<!--             </component> -->
            <bag fetch="select" inverse="true" name="observations" table="observation" order-by="phenomenontime">
                <key column="seriesid"/>
<!--                 <index column="phenomenontime"/> -->
                <one-to-many class="MeasurementDataEntity"/>
            </bag>
        </subclass>
    </class>
</hibernate-mapping>
